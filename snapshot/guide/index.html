<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>GORM GraphQL 2.0.2.BUILD-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <div class="navTitle">
                
                GORM GraphQL
            </div>
            <div class="navLinks">
                <ul>
                    <li>
                        <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#installation"><strong>2</strong><span>Installation</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>3</strong><span>Getting Started</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#customizations"><strong>4</strong><span>Customizing The Schema</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#types"><strong>5</strong><span>Type Conversion And Creation</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#dataFetchers"><strong>6</strong><span>Data Fetchers</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#dataBinders"><strong>7</strong><span>Data Binding</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#interceptors"><strong>8</strong><span>Interceptors</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#otherNotes"><strong>9</strong><span>Other Notes</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#APIDocs"><strong>10</strong><span>API Docs</span></a></div>
                                
                            </div>
                        </div>
                    </li>
                    <li class="separator selected">
                        <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                    </li>
                </ul>

            </div>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>GORM GraphQL</h1>
                            <p><strong>Authors:</strong> James Kleeh</p>
                            <p><strong>Version:</strong> 2.0.2.BUILD-SNAPSHOT</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#installation"><strong>2</strong><span>Installation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>3</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#create"><strong>3.1</strong><span>Create</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#read"><strong>3.2</strong><span>Read</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#list"><strong>3.3</strong><span>List</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#count"><strong>3.4</strong><span>Count</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#update"><strong>3.5</strong><span>Update</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#delete"><strong>3.6</strong><span>Delete</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#customizations"><strong>4</strong><span>Customizing The Schema</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#properties"><strong>4.1</strong><span>Properties</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#existing"><strong>4.1.1</strong><span>GORM Properties</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#custom"><strong>4.1.2</strong><span>Custom Properties</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#operations"><strong>4.2</strong><span>Operations</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#arguments"><strong>4.3</strong><span>Arguments</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#responseHandlers"><strong>4.4</strong><span>Validation Error and Delete Responses</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#namingConvention"><strong>4.5</strong><span>Naming Convention</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#configuration"><strong>4.6</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#types"><strong>5</strong><span>Type Conversion And Creation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#dataFetchers"><strong>6</strong><span>Data Fetchers</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#dataBinders"><strong>7</strong><span>Data Binding</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#interceptors"><strong>8</strong><span>Interceptors</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#otherNotes"><strong>9</strong><span>Other Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#APIDocs"><strong>10</strong><span>API Docs</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="imageblock" style="float: left">
<div class="content">
<img src="../img/logo.svg" alt="GraphQL" width="100" height="100">
</div>
</div>
<div class="paragraph">
<p>The GORM GraphQL library provides functionality to generate a GraphQL schema based on your GORM entities. If you aren&#8217;t sure what GraphQL is, please take a look at their <a href="http://graphql.org/">homepage</a>.</p>
</div>
<div class="paragraph">
<p>The underlying implementation of the GraphQL specification used by this library is <a href="http://graphql-java.readthedocs.io/en/stable/">graphql-java</a>.</p>
</div>
<div class="paragraph">
<p>There are two different binaries available for use. The first is the core library which contains all of the logic for building the schema. The second is a Grails plugin which, on top of core, provides several features.</p>
</div>
<div class="sect1">
<h2 id="_core_library">Core Library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to mapping domain classes to a GraphQL schema, the core library also provides default implementations of "data fetchers" to query, update, and delete data through executions of the schema.</p>
</div>
<div class="paragraph">
<p>Because GraphQL is different in the way that the fields requested to be returned are included with the request, it allows the server to be smart about the query being executed. For example, when a property is requested, the server knows whether or not that property is an association. If it is an association, the query parameters can be set to eagerly fetch the association, resulting in a single query instead of many. The end result is that less queries will be executed against your database, greatly increasing the performance of your API.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Requires Java 8. Effort has been made to support GORM 6.0.x, however this library is only tested against 6.1.x.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grails_plugin">Grails Plugin</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>A controller to receive and respond to GraphQL requests through HTTP, based on their <a href="http://graphql.org/learn/serving-over-http/">guidelines</a>.</p>
</li>
<li>
<p>Generates the schema at startup with spring bean configuration to make it easy to extend.</p>
</li>
<li>
<p>Includes a <a href="https://github.com/graphql/graphiql">GraphiQL</a> browser enabled by default in development. The browser is accessible at <code>/graphql/browser</code>.</p>
</li>
<li>
<p>Overrides the default data binder to use the data binding provided by Grails</p>
</li>
<li>
<p>Provides a <a href="../api/org/grails/gorm/graphql/plugin/testing/GraphQLSpec.html">trait</a> to make integration testing of your GraphQL endpoints easier.</p>
</li>
</ul>
</div>
</div>
</div>


<h1 id="installation">2 Installation</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/installation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use this library in your project, add the following dependency to the
<code>dependencies</code> block of your <code>build.gradle</code>:</p>
</div>
<div class="paragraph">
<p>For Grails applications</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile "org.grails.plugins:gorm-graphql-plugin:2.0.2.BUILD-SNAPSHOT"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For standalone projects</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile "org.grails:gorm-graphql:2.0.2.BUILD-SNAPSHOT"</code></pre>
</div>
</div>


<h1 id="gettingStarted">3 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_standalone_projects">Standalone Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For standalone projects, it is up to the developer how and when the schema gets created. A mapping context is required to create a schema. The mapping context is available on all <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/core/Datastore.html#getMappingContext()">datastore implementations</a>. See the <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#outsideGrails">GORM documentation</a> for information on creating a datastore.</p>
</div>
<div class="paragraph">
<p>The example below is the simplest way possible to generate a schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.model.MappingContext</span>
<span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

MappingContext mappingContext = ...
GraphQLSchema schema = <span class="keyword">new</span> <span class="predefined-type">Schema</span>(mappingContext).generate()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="http://graphql-java.readthedocs.io/en/stable/">graphql-java</a> documentation on how to use the schema to execute queries and mutations against it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grails_projects">Grails Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Grails projects, the schema is created automatically at startup. A spring bean is created for the schema called "graphQLSchema".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_schema">Using The Schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, no domain classes will be a part of the generated schema. It is an <strong>opt in</strong> functionality that requires you to explicitly state which domain classes will be a part of the schema.</p>
</div>
<div class="paragraph">
<p>The simplest way to include a domain class in the schema is to add the following to your domain class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just by adding the <code>graphql = true</code> property on your domain, full CRUD capabilities will be available in the schema. For example, if the domain class is called <code>Book</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Queries</p>
<div class="ulist">
<ul>
<li>
<p><code>book(id: ..)</code></p>
</li>
<li>
<p><code>bookList(max: .., sort: .., etc)</code></p>
</li>
<li>
<p><code>bookCount</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Mutations</p>
<div class="ulist">
<ul>
<li>
<p><code>bookCreate(book: {})</code></p>
</li>
<li>
<p><code>bookUpdate(id: .., book: {})</code></p>
</li>
<li>
<p><code>bookDelete(id: ..)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_practical_example">Practical Example</h3>
<div class="paragraph">
<p>Imagine you are building an API for a Conference. A talk can be presented
by a single speaker. A speaker can have many talks within the conference.
A typical one-to-many relationship which in <a href="http://gorm.grails.org">GORM</a>
could be expressed with:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Speaker.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">Speaker</span> {

    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> email
    <span class="predefined-type">String</span> bio

    <span class="directive">static</span> hasMany = [<span class="key">talks</span>: Talk]

    <span class="directive">static</span> graphql = <span class="predefined-constant">true</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">static</span> constraints = {
        email <span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">email</span>: <span class="predefined-constant">true</span>
        bio <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }

    <span class="directive">static</span> mapping = {
        bio <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>
        name <span class="key">formula</span>: <span class="string"><span class="delimiter">'</span><span class="content">concat(FIRST_NAME,</span><span class="char">\'</span><span class="content"> </span><span class="char">\'</span><span class="content">,LAST_NAME)</span><span class="delimiter">'</span></span>
        talks <span class="key">sort</span>: <span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>it exposes this domain class to the GraphQL API</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Talk.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">Talk</span> {

    <span class="predefined-type">String</span> title
    <span class="type">int</span> duration

    <span class="directive">static</span> belongsTo = [<span class="key">speaker</span>: Speaker]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
GORM GraphQL plugin supports <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#derivedProperties">Derived Properties</a> as illustrated in the previous example; <code>name</code> is derived property which concatenates <code>firstName</code> and <code>lastName</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>


<h2 id="create">3.1 Create</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/create.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_create">Create</h3>
<div class="paragraph">
<p>In this example the request is a mutation to create a speaker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
mutation {
  speakerCreate(speaker: {
    firstName: "James"
    lastName: "Kleeh"
  }) {
    id
    firstName
    lastName
    errors {
      field
      message
    }
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API answers with the properties we requested.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speakerCreate</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">James</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Kleeh</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>: [

            ]
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there was a validation error during the create process, the <code>errors</code> property would be populated with the validation errors.
</td>
</tr>
</table>
</div>
</div>


<h2 id="read">3.2 Read</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/read.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this example the query is attempting to retrieve the details of a single speaker with an id of <code>1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
{
  speaker(id: 1) {
    firstName
    lastName
    bio
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the api responds with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speaker</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jeff Scott</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Brown</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">bio</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jeff is a co-founder of the Grails framework, and a core member of the Grails development team.</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>


<h2 id="list">3.3 List</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/list.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this example the query is demonstrating retrieving a list of speakers. Since the talks of the speaker are requested to be returned, the association will be eagerly fetched to make the process as efficient as possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
{
  speakerList(max: 3) {
    id
    name
    talks {
      title
    }
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speakerList</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jeff Scott Brown</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">talks</span><span class="delimiter">&quot;</span></span>: [
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Polyglot Web Development with Grails 3</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">REST With Grails 3</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Testing in Grails 3</span><span class="delimiter">&quot;</span></span>
                    }
                ]
            },
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Graeme Rocher</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">talks</span><span class="delimiter">&quot;</span></span>: [
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">What's New in Grails?</span><span class="delimiter">&quot;</span></span>
                    },
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Latest and Greatest in GORM</span><span class="delimiter">&quot;</span></span>
                    }
                ]
            },
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Paul King</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">talks</span><span class="delimiter">&quot;</span></span>: [
                    {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Groovy: The Awesome Parts</span><span class="delimiter">&quot;</span></span>
                    }
                ]
            }
        ]
    }
}</code></pre>
</div>
</div>


<h2 id="count">3.4 Count</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/count.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this example the query is demonstrating retrieving the total count of speakers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
{
  speakerCount
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speakerCount</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>
    }
}</code></pre>
</div>
</div>


<h2 id="update">3.5 Update</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/update.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this example we are updating properties of a speaker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
mutation {
  speakerUpdate(id: 7, speaker: {
    bio: "Zachary is a member of the Grails team at OCI"
  }) {
    id
    bio
    talks {
      id
      duration
    }
    errors {
      field
      message
    }
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the server acknowledges the update:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speakerUpdate</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">bio</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Zachary is a member of the Grails team at OCI</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">talks</span><span class="delimiter">&quot;</span></span>: [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">14</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">duration</span><span class="delimiter">&quot;</span></span>: <span class="integer">50</span>
                },
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">15</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">duration</span><span class="delimiter">&quot;</span></span>: <span class="integer">50</span>
                }
            ],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>: [

            ]
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there was a validation error during the update process, the <code>errors</code> property would be populated with the validation errors.
</td>
</tr>
</table>
</div>


<h2 id="delete">3.6 Delete</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/gettingStarted/delete.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this example we are deleting a speaker. None of the normal properties of a speaker are available, however a <code>success</code> property is available to let you know whether or not the operation was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
mutation {
  speakerDelete(id: 8) {
    success
    error
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the server acknowledges the deletion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">speakerDelete</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>  <i class="conum" data-value="1"></i><b>(1)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The message of any exception that occurred will be returned if the action wasn&#8217;t successful.</td>
</tr>
</table>
</div>


<h1 id="customizations">4 Customizing The Schema</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The GraphQL specification allows for properties, types, operations, etc to have metadata associated with them. Metadata might include a description or deprecation. This library exposes APIs to allow the user to customize that metadata.</p>
</div>


<h2 id="properties">4.1 Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/properties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="existing">4.1.1 GORM Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/properties/existing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_persistent_property_options">Persistent Property Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to control several aspects of how existing persistent properties on GORM entities are represented in the generated schema.</p>
</div>
<div class="paragraph">
<p>There are several ways to modify the fields available. Consider a property <code>foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLMapping</span>
<span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLPropertyMapping</span>

<span class="directive">static</span> graphql = GraphQLMapping.build {

    foo <span class="key">description</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>
    <span class="comment">//or</span>
    foo {
        description <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>
    }
    <span class="comment">//or (code completion)</span>
    foo GraphQLPropertyMapping.build {
        description <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>
    }
    <span class="comment">//or</span>
    property(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, <span class="key">description</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>)
    <span class="comment">//or (code completion)</span>
    property(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>) {
        description <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>
    }
    <span class="comment">//or (code completion)</span>
    property(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, GraphQLPropertyMapping.build {
        description <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>
    })
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_exclusion">Exclusion</h3>
<div class="paragraph">
<p>To exclude a property from being included from the schema entirely:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLMapping</span>

<span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> graphql = GraphQLMapping.build {
        exclude(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a property read only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">input</span>: <span class="predefined-constant">false</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a property write only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">output</span>: <span class="predefined-constant">false</span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nullable">Nullable</h3>
<div class="paragraph">
<p>By default, a property will be nullable based on the constraints provided in the domain class. You can override that specifically for GraphQL, however.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>) <span class="comment">//or true</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fetching">Fetching</h3>
<div class="paragraph">
<p>To customize the way a property is retrieved, you can supply a data fetcher with a closure. The domain instance is passed as an argument to the closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) {
        dataFetcher { Author author -&gt;
            author.name ?: <span class="string"><span class="delimiter">&quot;</span><span class="content">Default Name</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The data type returned must be the same as the property type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_description">Description</h3>
<div class="paragraph">
<p>A description of a property can be specified in the mapping to be registered in the schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">The name of the author</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecation">Deprecation</h3>
<div class="paragraph">
<p>A property can be marked as deprecated in the schema to inform users the property may be removed in the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">deprecationReason</span>: <span class="string"><span class="delimiter">'</span><span class="content">To be removed August 1st, 2018</span><span class="delimiter">'</span></span>)
    <span class="comment">//or</span>
    property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">deprecated</span>: <span class="predefined-constant">true</span>) <span class="comment">//&quot;Deprecated&quot; will be the reason</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_name">Name</h3>
<div class="paragraph">
<p>It is possible to change the name of existing properties as they appear in the schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    property(<span class="string"><span class="delimiter">'</span><span class="content">authority</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
When changing the name of a property, you must also account for the change when it comes to data binding in create or update operations. The following is an example data binder implementation for changing the property name from <code>authority</code> to <code>name</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.binding.GrailsGraphQLDataBinder</span>

<span class="type">class</span> <span class="class">RoleDataBinder</span> <span class="directive">extends</span> GrailsGraphQLDataBinder {

    <span class="annotation">@Override</span>
    <span class="type">void</span> bind(<span class="predefined-type">Object</span> object, <span class="predefined-type">Map</span> data) {
        data.put(<span class="string"><span class="delimiter">'</span><span class="content">authority</span><span class="delimiter">'</span></span>, data.remove(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>))
        <span class="local-variable">super</span>.bind(object, data)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data binding implementation is removing the <code>name</code> property and assigning it back to <code>authority</code> so it can be correctly bound to the domain object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_order">Order</h3>
<div class="paragraph">
<p>The order in which the fields appear in the schema can be customized.
By default any identity properties and the version property appear first in order.</p>
</div>
<div class="paragraph">
<p>To customize the order of an existing property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">   <span class="directive">static</span> graphql = GraphQLMapping.build {
       property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="key">order</span>: <span class="integer">1</span>)
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the order is supplied via the constraints block, then that value will be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">   <span class="directive">static</span> constraints = {
        name <span class="key">order</span>: <span class="integer">1</span>
   }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the order is specified in both the constraints and the property mapping, the property mapping wins. If the order of two or more properties is the same, they are then sorted by name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If no order is specified, the default order provided by GORM is used. To enable name based sorting by default, configure the default constraints to set the order property to 0 for all domains.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.gorm.default.constraints = {
   <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>(<span class="key">order</span>: <span class="integer">0</span>)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To customize properties to come before the identifier or version, set the value as negative. The default order for id properties is -20 and the default order for version properties is -10.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>


<h2 id="custom">4.1.2 Custom Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/properties/custom.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_adding_custom_properties">Adding Custom Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to add custom properties to your domain class solely for the use in the GraphQL schema. You must supply either a custom data binder or a setter method for properties that will be used for input. For output, a data fetcher or getter method must be made available.</p>
</div>
<div class="paragraph">
<p>In this example we are adding a property to the GraphQL schema that will allow users to retrieve the age of authors. In this case the property doesn&#8217;t make sense to allow users to provide the property when creating or updating because they should be modifying the <code>birthDay</code> instead. For that reason, <code>input false</code> is specified to prevent that behavior.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Supplying other domain classes as the return type is supported
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLMapping</span>
<span class="keyword">import</span> <span class="include">java.time.Period</span>

<span class="type">class</span> <span class="class">Author</span> {

    LocalDate birthDay

    <span class="directive">static</span> graphql = GraphQLMapping.build {
        add(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="predefined-type">Integer</span>) {
            dataFetcher { Author author -&gt;
                Period.between(author.birthDay, LocalDate.now()).years
            }
            input <span class="predefined-constant">false</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of providing a data fetcher, it is possible to create a getter method to do the same thing.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Integer</span> getAge() {
    Period.between(birthDay, LocalDate.now()).years
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_returning_a_collection">Returning A Collection</h3>
<div class="paragraph">
<p>The above example creates a custom property that returns an Integer. The property were to return a collection, the following notation can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">add(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, [<span class="predefined-type">Integer</span>]) {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nullable_description_deprecation">Nullable, Description, Deprecation</h3>
<div class="paragraph">
<p>Very similar to how existing domain properties can be configured, it is also possible to configure additional properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">add(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="predefined-type">Integer</span>) {

    nullable <span class="predefined-constant">false</span> <span class="comment">//default is true</span>

    description <span class="string"><span class="delimiter">'</span><span class="content">How old the author is in years</span><span class="delimiter">'</span></span>

    deprecationReason <span class="string"><span class="delimiter">'</span><span class="content">To be removed in the future</span><span class="delimiter">'</span></span>
    <span class="comment">//or</span>
    deprecated <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_read_or_write_only">Read or Write Only</h3>
<div class="paragraph">
<p>Custom properties can also be controlled in the same way to existing properties in regards to whether they are read or write only.</p>
</div>
<div class="paragraph">
<p>To make a property read only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">add(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>) {
    input <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a property write only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">add(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>) {
    output <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_type">Custom Type</h3>
<div class="paragraph">
<p>If a property needs to handle something more complex than a collection of a single class, this library supports creating custom types.</p>
</div>
<div class="paragraph">
<p>For example if our age property needs to return years, months, and days:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLMapping</span>
<span class="keyword">import</span> <span class="include">java.time.temporal.ChronoUnit</span>

<span class="type">class</span> <span class="class">Author</span> {

    LocalDate birthDay

    <span class="predefined-type">Map</span> getAge() {
        LocalDate now = LocalDate.now()

        [<span class="key">days</span>: ChronoUnit.DAYS.between(birthDay, now),
         <span class="key">months</span>: ChronoUnit.MONTHS.between(birthDay, now),
         <span class="key">years</span>: ChronoUnit.YEARS.between(birthDay, now)]
    }

    <span class="directive">static</span> graphql = GraphQLMapping.build {
        add(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Age</span><span class="delimiter">'</span></span>) {
            input <span class="predefined-constant">false</span>
            type {
                field(<span class="string"><span class="delimiter">'</span><span class="content">days</span><span class="delimiter">'</span></span>, <span class="predefined-type">Long</span>)
                field(<span class="string"><span class="delimiter">'</span><span class="content">months</span><span class="delimiter">'</span></span>, <span class="predefined-type">Long</span>)
                field(<span class="string"><span class="delimiter">'</span><span class="content">years</span><span class="delimiter">'</span></span>, <span class="predefined-type">Long</span>)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example we have added a new property to the domain class called <code>age</code>. That property returns a custom data type that consists of 3 properties. The name that represents that type in the GraphQL schema is "Age". In our getter method we are returning a Map that contains those properties, however any POGO that contains those properties would work as well.</p>
</div>
<div class="paragraph">
<p>Similar to properties, the fields themselves can have complex subtypes with the <code>field(String, String, Closure)</code> method signature.</p>
</div>
<div class="paragraph">
<p>For instance if we were to add a property to our domain to represent a list of books:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.entity.dsl.GraphQLMapping</span>

<span class="type">class</span> <span class="class">Author</span> {

    <span class="comment">//A getter method or dataFetcher is required to make this configuration valid</span>
    <span class="directive">static</span> graphql = GraphQLMapping.build {
        add(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>) {
            type {
                field(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
                field(<span class="string"><span class="delimiter">'</span><span class="content">publisher</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Publisher</span><span class="delimiter">'</span></span>) {
                    field(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
                    field(<span class="string"><span class="delimiter">'</span><span class="content">address</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
                }
                collection <span class="predefined-constant">true</span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When creating custom types, it is important that the name you choose does not already exist. For example if this application also had a Publisher domain class, the types will conflict because in GraphQL the type names must be unique.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_order">Order</h3>
<div class="paragraph">
<p>The order in which the fields appear in the schema can be customized.
By default any identity properties and the version property appear first in order.</p>
</div>
<div class="paragraph">
<p>To customize the order of a custom property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">   <span class="directive">static</span> graphql = GraphQLMapping.build {
       add(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>) {
            order <span class="integer">1</span>
       }
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no order is specified, added properties will be put at the end of the list of properties in the schema. Properties with the same or no order will be ordered by name.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To customize properties to come before the identifier or version, set the value as negative. The default order for id properties is -20 and the default order for version properties is -10.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>


<h2 id="operations">4.2 Operations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/operations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_provided_operations">Provided Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 3 query (get, list, count) and 3 mutation (create, update, delete) operations provided by default for all entities mapped with GraphQL are called the provided operations.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the provided operations as well as disable their creation.</p>
</div>
<div class="sect2">
<h3 id="_disabling_all_operations">Disabling All Operations</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.all.enabled <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_a_provided_operation">Disabling A Provided Operation</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.delete.enabled <span class="predefined-constant">false</span>
    <span class="comment">//or</span>
    <span class="comment">//operations.get</span>
    <span class="comment">//operations.list</span>
    <span class="comment">//operations.count</span>
    <span class="comment">//operations.create</span>
    <span class="comment">//operations.update</span>
    <span class="comment">//operations.delete</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_all_mutation_write_operation">Disabling All Mutation(Write) Operation</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.mutation.enabled <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_all_query_read_operation">Disabling All Query(Read) Operation</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.query.enabled <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metadata">Metadata</h3>
<div class="paragraph">
<p>The mapping closure also allows the description and deprecation status of the provided operations to be manipulated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.get
        .description(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retrieve a single instance</span><span class="delimiter">&quot;</span></span>)
        .deprecationReason(<span class="string"><span class="delimiter">&quot;</span><span class="content">Use newBook instead</span><span class="delimiter">&quot;</span></span>)

    operations.delete.deprecated(<span class="predefined-constant">true</span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pagination">Pagination</h3>
<div class="paragraph">
<p>By default, list operations return a list of instances. For most pagination solutions, that is not enough data. In addition to the list of results, the total count is required to be able to calculate pagination controls. Pagination is supported in this library through configuration of the list operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> graphql = GraphQLMapping.build {
    operations.list.paginate(<span class="predefined-constant">true</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By configuring the list operation to paginate, instead of a list of results being returned, an object will be returned that has a "results" value, which is the list, and a "totalCount" value which is the total count not considering the pagination parameters.</p>
</div>
<div class="sect3">
<h4 id="_customization">Customization</h4>
<div class="paragraph">
<p>It is possible to customize how the pagination response is created through the creation of a <a href="../api/org/grails/gorm/graphql/response/pagination/GraphQLPaginationResponseHandler.html">GraphQLPaginationResponseHandler</a>.</p>
</div>
<div class="paragraph">
<p>How you can supply your own pagination response handler depends on whether the library is being used standalone or part of a Grails application.</p>
</div>
<div class="paragraph">
<p>For standalone applications, simply set the handler on the schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.paginationResponseHandler = <span class="keyword">new</span> MyPaginationResponseHandler()
...
schema.generate()</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Grails applications, override the <code>graphQLPaginationResponseHandler</code> bean.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/config/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    graphQLPaginationResponseHandler(MyPaginationResponseHandler)
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data fetchers must respond according to the object type definition created by the pagination response handler. When supplying your own data fetcher, implement <a href="../api/org/grails/gorm/graphql/fetcher/PaginatingGormDataFetcher.html">PaginatingGormDataFetcher</a> and the response handler will be populated for you. The response handler is responsible for creating the response in order to assure it is compatible.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_operations">Custom Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the provided operations, it is possible to add custom operations through the mapping block in an entity.</p>
</div>
<div class="paragraph">
<p>Custom operations can be defined with the <code>query</code> method and the <code>mutation</code> method, depending on what category the operation being added falls into. In both cases the API is exactly the same.</p>
</div>
<div class="sect2">
<h3 id="_definition">Definition</h3>
<div class="paragraph">
<p>Custom operations must be defined in the mapping block of GORM entities. In the example below we have an <code>Author</code> class that has a <code>name</code>. We want to create a custom operation to retrieve an author by it&#8217;s name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> graphql = GraphQLMapping.build {

        <span class="comment">//authorByName is the name exposed by the API</span>
        <span class="comment">//Author is the return type</span>
        query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) { <span class="comment">//or [Author] to return a list of authors</span>
            ...
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case where a pagination result should be returned from the custom operation, a simple method <code>pagedResult</code> is available to mark the type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> graphql = GraphQLMapping.build {

        <span class="comment">//authorsByName is the name exposed by the API</span>
        <span class="comment">//The return type will have a results key and a totalCount key</span>
        query(<span class="string"><span class="delimiter">'</span><span class="content">authorsByName</span><span class="delimiter">'</span></span>, pagedResult(Author)) {
            ...
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For operations with a custom return type, it possible to define a custom type using the <code>returns</code> block. The API inside of the returns block is exactly the same as the API for defining <a href="#custom">custom properties</a> with custom types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">mutation(<span class="string"><span class="delimiter">'</span><span class="content">deleteAuthors</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">AuthorsDeletedResponse</span><span class="delimiter">'</span></span>) {
    returns {
        field(<span class="string"><span class="delimiter">'</span><span class="content">deletedCount</span><span class="delimiter">'</span></span>, <span class="predefined-type">Long</span>)
        field(<span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span>, <span class="predefined-type">Boolean</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data fetcher provided must have the defined fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metadata_2">Metadata</h3>
<div class="paragraph">
<p>Description and deprecation information can also be supplied for custom operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) { <span class="comment">//or [Author] to return a list of authors</span>
    description <span class="string"><span class="delimiter">'</span><span class="content">Retrieves an author where the name equals the supplied name`</span></span><span class="error">
</span>
    deprecated <span class="predefined-constant">true</span>
    <span class="comment">//or</span>
    deprecationReason <span class="string"><span class="delimiter">'</span><span class="content">Use authorWhereName instead`</span></span><span class="error">
</span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_fetcher">Data Fetcher</h3>
<div class="paragraph">
<p>When creating a custom operation, it is necessary to supply a "data fetcher". The data fetcher is responsible for returning data to GraphQL to be used in generating the response. The data fetcher must be an instance of <code>graphql.schema.DataFetcher</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="directive">static</span> graphql = GraphQLMapping.build {
        argument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) {
            dataFetcher(<span class="keyword">new</span> DataFetcher&lt;&gt;() {
                <span class="annotation">@Override</span>
                <span class="predefined-type">Object</span> get(DataFetchingEnvironment environment) {
                    Author.findByName(environment.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>))
                }
            })
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will function properly, however it is missing out on one of the best features of this library, query optimization. If books were requested to be returned, a separate query would need to be executed to retrieve the books. To make this better, the recommendation is to always extend from one of the provided data fetchers.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/SingleEntityDataFetcher.html">SingleEntityDataFetcher</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/EntityDataFetcher.html">EntityDataFetcher</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIST (Paginated Response)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/PaginatedEntityDataFetcher.html">PaginatedEntityDataFetcher</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/CreateEntityDataFetcher.html">CreateEntityDataFetcher</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/UpdateEntityDataFetcher.html">UpdateEntityDataFetcher</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/org/grails/gorm/graphql/fetcher/impl/DeleteEntityDataFetcher.html">EntityDataFetcher</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the data fetcher you wish to create does not fit well in any of the above use cases, you can extend directly from <a href="../api/org/grails/gorm/graphql/fetcher/DefaultGormDataFetcher.html">DefaultGormDataFetcher</a>, which has all of the query optimization logic.</p>
</div>
<div class="paragraph">
<p>All of the classes above have a constructor which takes in a <a href="http://gorm.grails.org/latest/api/org/grails/datastore/mapping/model/PersistentEntity.html">PersistentEntity</a>. The easiest way to get a persistent entity from a domain class is to execute the static <code>gormPersistentEntity</code> method.</p>
</div>
<div class="paragraph">
<p>Using the above information, we can change the <code>authorByName</code> to extend from the <a href="../api/org/grails/gorm/graphql/fetcher/impl/SingleEntityDataFetcher.html">SingleEntityDataFetcher</a> class because we are returning a single <code>Author</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="directive">static</span> graphql = GraphQLMapping.lazy {
        query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) {
            argument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
            dataFetcher(<span class="keyword">new</span> SingleEntityDataFetcher&lt;&gt;(Author.gormPersistentEntity) {
                <span class="annotation">@Override</span>
                <span class="directive">protected</span> DetachedCriteria buildCriteria(DataFetchingEnvironment environment) {
                    Author.where { name == environment.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) }
                }
            })
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Note the use of <code>GraphQLMapping.lazy</code> in this example. Because we are accessing the persistent entity, the GORM mapping context must be created before this code is evaluated. The <code>lazy</code> method will execute the provided code when the mapping is requested (during schema creation), instead of at class initialization time. By that time it is expected that GORM is available.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>


<h2 id="arguments">4.3 Arguments</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/arguments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_arguments">Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Arguments are how users supply data to your custom operation or field. Arguments support simple types (String, Integer, etc) as well as custom types that you define.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) {
    argument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>) <span class="comment">//To take in a single string</span>

    argument(<span class="string"><span class="delimiter">'</span><span class="content">names</span><span class="delimiter">'</span></span>, [<span class="predefined-type">String</span>]) <span class="comment">//To take in a list of strings</span>

    argument(<span class="string"><span class="delimiter">'</span><span class="content">fullName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">AuthorNameArgument</span><span class="delimiter">'</span></span>) { <span class="comment">//A custom argument</span>
        accepts {
            field(<span class="string"><span class="delimiter">'</span><span class="content">first</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
            field(<span class="string"><span class="delimiter">'</span><span class="content">last</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API inside of the last argument block is exactly the same as the API for defining <a href="#custom">custom properties</a> with custom types.</p>
</div>
<div class="sect2">
<h3 id="_argument_metadata">Argument Metadata</h3>
<div class="paragraph">
<p>GraphQL has the ability to store metadata about arguments to operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) {
    argument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>) {
        defaultValue <span class="string"><span class="delimiter">'</span><span class="content">John</span><span class="delimiter">'</span></span> <span class="comment">//Supply a sensible default</span>

        nullable <span class="predefined-constant">true</span> <span class="comment">//Allow a null value (default false)</span>

        description <span class="string"><span class="delimiter">'</span><span class="content">The name of the author to search for</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_argument_inputs">Using Argument Inputs</h3>
<div class="paragraph">
<p>Within your supplied DataFetcher, arguments can easily be retrieved from their corresponding DataFetchingEnvironment and used as necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">String</span> name

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="directive">static</span> graphql = GraphQLMapping.build {
        query(<span class="string"><span class="delimiter">'</span><span class="content">authorByName</span><span class="delimiter">'</span></span>, Author) {
            argument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
            dataFetcher(<span class="keyword">new</span> DataFetcher&lt;&gt;() {
                <span class="annotation">@Override</span>
                <span class="predefined-type">Object</span> get(DataFetchingEnvironment environment) {
                    Author.findByName(environment.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>))
                }
            })
        }
        add(<span class="string"><span class="delimiter">'</span><span class="content">booksPublishedBetween</span><span class="delimiter">'</span></span>, [<span class="predefined-type">Book</span>]) {
            input(<span class="predefined-constant">false</span>)
            argument(<span class="string"><span class="delimiter">'</span><span class="content">from</span><span class="delimiter">'</span></span>, <span class="predefined-type">Date</span>)
            argument(<span class="string"><span class="delimiter">'</span><span class="content">to</span><span class="delimiter">'</span></span>, <span class="predefined-type">Date</span>)
            dataFetcher { Author author, ClosureDataFetchingEnvironment environment -&gt;
                <span class="predefined-type">Date</span> from = environment.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">from</span><span class="delimiter">'</span></span>)
                <span class="predefined-type">Date</span> to = environment.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">to</span><span class="delimiter">'</span></span>)
                <span class="predefined-type">Book</span>.where {
                    author == author
                    published &gt;= from
                    published &lt;= to
                }.list()
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example would support the following type of query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphql">query {
  authorByName(name: &quot;Herman Melville&quot;) {
    booksPublishedBetween(from: &quot;1850-01-01&quot;, to: &quot;1852-12-31&quot;) {
      title
      pageCount
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>


<h2 id="responseHandlers">4.4 Validation Error and Delete Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/responseHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The way the provided operations respond after deleting a GORM entity instance and how validation errors are returned is customizable.</p>
</div>
<div class="sect1">
<h2 id="_delete_response">Delete Response</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Delete responses are handled by a <a href="../api/org/grails/gorm/graphql/response/delete/GraphQLDeleteResponseHandler.html">GraphQLDeleteResponseHandler</a>. The default implementation responds with an object that has a single property, <code>success</code>. You can register your own handler to override the default.</p>
</div>
<div class="paragraph">
<p>For reference, see the <a href="https://github.com/grails/gorm-graphql/blob/master/core/src/main/groovy/org/grails/gorm/graphql/response/delete/DefaultGraphQLDeleteResponseHandler.groovy">default handler</a>.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>After creating the schema, but before calling generate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.deleteResponseHandler = <span class="keyword">new</span> MyDeleteResponseHandler()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grails">Grails</h3>
<div class="paragraph">
<p>To override the delete response handler in a Grails application, register a bean with the name "graphQLDeleteResponseHandler".</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graphQLDeleteResponseHandler(MyDeleteResponseHandler)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_validation_error_response">Validation Error Response</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Validation error responses are handled by a <a href="../api/org/grails/gorm/graphql/response/errors/GraphQLErrorsResponseHandler.html">GraphQLErrorsResponseHandler</a>.</p>
</div>
<div class="paragraph">
<p>For reference, see the <a href="https://github.com/grails/gorm-graphql/blob/master/core/src/main/groovy/org/grails/gorm/graphql/response/errors/DefaultGraphQLErrorsResponseHandler.groovy">default handler</a>.</p>
</div>
<div class="paragraph">
<p>If you plan to extend the default handler, a message source is required.</p>
</div>
<div class="sect2">
<h3 id="_standalone_2">Standalone</h3>
<div class="paragraph">
<p>The errors response handler is a property of the type manager. If you are supplying a custom type manager to the schema, set the property on it directly. If you are relying on the default type manager, do the following after creating the schema, but before calling generate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.errorsResponseHandler = <span class="keyword">new</span> MyErrorsResponseHandler()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grails_2">Grails</h3>
<div class="paragraph">
<p>To override the errors response handler in a Grails application, register a bean with the name "graphQLErrorsResponseHandler".</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graphQLErrorsResponseHandler(MyErrorsResponseHandler, ref(<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
</div>
</div>
</div>


<h2 id="namingConvention">4.5 Naming Convention</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/namingConvention.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_custom_naming_conventions">Custom Naming Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The names used to describe entities is configurable through the use of an <a href="../api/org/grails/gorm/graphql/entity/GraphQLEntityNamingConvention.html">GraphQLEntityNamingConvention</a>.</p>
</div>
<div class="paragraph">
<p>The class controls the name of the default operations and the names of the GraphQL types built from the GORM entities.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>The naming convention is a property of the type manager. If you are supplying a custom type manager to the schema, set the property on it directly. If you are relying on the default type manager, do the following after creating the schema, but before calling generate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.namingConvention = <span class="keyword">new</span> MyNamingConvention()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grails">Grails</h3>
<div class="paragraph">
<p>To override the naming convention in a Grails application, register a bean with the name "graphQLEntityNamingConvention" that extends <a href="../api/org/grails/gorm/graphql/entity/GraphQLEntityNamingConvention.html">GraphQLEntityNamingConvention</a>.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graphQLEntityNamingConvention(MyNamingConvention)</code></pre>
</div>
</div>
</div>
</div>
</div>


<h2 id="configuration">4.6 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/customizations/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_standalone">Standalone</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The schema has several properties that can be modified.</p>
</div>
<div class="sect2">
<h3 id="_list_arguments">List Arguments</h3>
<div class="paragraph">
<p>A map where the key is a string (one of <a href="../api/org/grails/gorm/graphql/fetcher/impl/EntityDataFetcher.html#ARGUMENTS">EntityDataFetcher.ARGUMENTS</a>) and the value is the class the argument should be coerced into.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.listArguments = (<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Class</span>&gt;)..</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_date_type">Date Type</h3>
<div class="paragraph">
<p>If a date type is not already registered with the type manager, a default one will be provided. The default type can be customized with the date formats that should be attempted to convert user input, and whether or not the parsing should be lenient.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.dateFormats = (<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;)...
schema.dateFormatLenient = (<span class="type">boolean</span>)...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The date formats will also be used for the Java 8 date types.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugin">Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following options are available to configure for Grails applications using the plugin.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.graphql.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the plugin is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.graphql.dateFormats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">- yyyy-MM-dd HH:mm:ss.S,
  - yyyy-MM-dd&#8217;T&#8217;HH:mm:ss&#8217;Z'
  - yyyy-MM-dd HH:mm:ss.S z
  - yyyy-MM-dd&#8217;T&#8217;HH:mm:ss.SSSX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the setting is not provided, the <code>grails.databinding.dateFormats</code> will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.graphql.dateFormatLenient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the setting is not provided, the <code>grails.databinding.dateParsingLenient</code> will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.graphql.listArguments</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, Class&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default arguments in <a href="../api/org/grails/gorm/graphql/fetcher/impl/EntityDataFetcher.html#ARGUMENTS">EntityDataFetcher.ARGUMENTS</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.graphql.browser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True (only in development)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the <code>GraphqlController.browser</code> action which by default responds on the <code>graphql/browser</code> endpoint is enabled</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_fetching_context">Fetching Context</h3>
<div class="paragraph">
<p>Data fetchers in GraphQL have a "context". The context is really just an Object field that can contain anything you like with the purpose of exposing it to the data fetching environment. For example, the default context created by the plugin is a Map that contains the request locale. The locale is used to render validation error messages.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you prefer to set the context to a custom class, implement <a href="../api/org/grails/gorm/graphql/fetcher/context/LocaleAwareContext.html">LocaleAwareContext</a> and the default validation errors response handler will retrieve the locale from the object.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is common to need to manipulate the context to include data that some or all of your data fetchers might need. If a fetcher needs to be aware of the current user and you are using the spring security plugin, you may want to add the <code>springSecurityService</code> to the context.</p>
</div>
<div class="paragraph">
<p>To customize the context, register a bean named "graphQLContextBuilder" of type <a href="../api/org/grails/gorm/graphql/plugin/GraphQLContextBuilder.html">GraphQLContextBuilder</a>. If the default errors handler is being used, extend from <a href="../api/org/grails/gorm/graphql/plugin/DefaultGraphQLContextBuilder.html">DefaultGraphQLContextBuilder</a> and add to the result of the super method call.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLContextBuilder.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.DefaultGraphQLContextBuilder</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>
<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.SpringSecurityService</span>

<span class="type">class</span> <span class="class">MyGraphQLContextBuilder</span> <span class="directive">extends</span> DefaultGraphQLContextBuilder {

    <span class="annotation">@Autowired</span>
    SpringSecurityService springSecurityService

    <span class="annotation">@Override</span>
    <span class="predefined-type">Map</span> buildContext(GrailsWebRequest request) {
        <span class="predefined-type">Map</span> context = <span class="local-variable">super</span>.buildContext(request)
        context.springSecurityService = springSecurityService
        context
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graphQLContextBuilder(MyGraphQLContextBuilder)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in a data fetcher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">T get(DataFetchingEnvironment environment) {
    ((<span class="predefined-type">Map</span>) environment.context).springSecurityService
}</code></pre>
</div>
</div>
</div>
</div>
</div>


<h1 id="types">5 Type Conversion And Creation</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is the responsibility of the type manager to convert Java classes to GraphQL types used in the creation of the schema. All of the basic GORM types have corresponding converters registered in the default type manager. It may be necessary to register GraphQL types for classes used in your domain model.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The type manager is designed to store GraphQL types for non GORM entities (simple types). If you encounter a <a href="../api/org/grails/gorm/graphql/types/TypeNotFoundException.html">TypeNotFoundException</a>, it is likely you will need to register a type for the missing class.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_get_the_manager">Get The Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register type converters, you need to get a reference to the <a href="../api/org/grails/gorm/graphql/types/GraphQLTypeManager.html">GraphQLTypeManager</a>. If you are using the manager provided by default, how you access it will depend on whether you are using the plugin or standalone.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>When creating the schema, initialize it first. The default type manager will then be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.initialize()
GraphQLTypeManager typeManager = schema.typeManager
...
schema.generate()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugin">Plugin</h3>
<div class="paragraph">
<p>For Grails applications it is recommended to reference the bean created by the plugin. The easiest way to do so is to register a bean post processor. The plugin has a class available to extend to make that easier.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myGraphQLCustomizer(MyGraphQLCustomizer)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLCustomizer.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.GraphQLPostProcessor</span>

<span class="type">class</span> <span class="class">MyGraphQLCustomizer</span> <span class="directive">extends</span> GraphQLPostProcessor {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWith(GraphQLTypeManager typeManager) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to customize more than 1 manager, only a single bean needs to be registered. There are <code>doWith</code> methods for all of the managers you may need to register object instances with.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_converter">Register A Converter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have access to the manager, registration of your own type is easy. In this example a type is being registered to handle a Mongo <code>ObjectId</code>. The type will be used to do conversion of arguments in GraphQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This process only handles how an ObjectId will be created from either Java arguments, or arguments passed inline in the GraphQL query or mutation. For Grails applications, the process of rendering the ObjectID as json is handled by <a href="http://views.grails.org">JSON views</a>. To supply behavior for how an ObjectId is rendered, see the documentation for json views. For standalone projects, you are responsible for any conversions that may need to happen.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">graphql.schema.GraphQLScalarType</span>
<span class="keyword">import</span> <span class="include">org.bson.types.ObjectId</span>
<span class="keyword">import</span> <span class="include">graphql.schema.Coercing</span>

GraphQLTypeManager typeManager

typeManager.registerType(ObjectId, <span class="keyword">new</span> GraphQLScalarType(<span class="string"><span class="delimiter">&quot;</span><span class="content">ObjectId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hex representation of a Mongo object id</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Coercing&lt;ObjectId, ObjectId&gt;() {

    <span class="directive">protected</span> Optional&lt;ObjectId&gt; convert(<span class="predefined-type">Object</span> input) {
        <span class="keyword">if</span> (input <span class="keyword">instanceof</span> ObjectId) {
            Optional.of((ObjectId) input)
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (input <span class="keyword">instanceof</span> <span class="predefined-type">String</span>) {
            parseObjectId((<span class="predefined-type">String</span>) input)
        }
        <span class="keyword">else</span> {
            Optional.empty()
        }
    }

    <span class="annotation">@Override</span>
    ObjectId serialize(<span class="predefined-type">Object</span> input) {
        convert(input).orElseThrow( {
            <span class="keyword">throw</span> <span class="keyword">new</span> CoercingSerializeException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not convert </span><span class="inline"><span class="inline-delimiter">${</span>input.class.name<span class="inline-delimiter">}</span></span><span class="content"> to an ObjectId</span><span class="delimiter">&quot;</span></span>)
        })
    }

    <span class="annotation">@Override</span>
    ObjectId parseValue(<span class="predefined-type">Object</span> input) {
        convert(input).orElseThrow( {
            <span class="keyword">throw</span> <span class="keyword">new</span> CoercingParseValueException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not convert </span><span class="inline"><span class="inline-delimiter">${</span>input.class.name<span class="inline-delimiter">}</span></span><span class="content"> to an ObjectId</span><span class="delimiter">&quot;</span></span>)
        })
    }

    <span class="annotation">@Override</span>
    ObjectId parseLiteral(<span class="predefined-type">Object</span> input) {
        <span class="keyword">if</span> (input <span class="keyword">instanceof</span> StringValue) {
            parseObjectId(((StringValue) input).value).orElse(<span class="predefined-constant">null</span>)
        }
        <span class="keyword">else</span> {
            <span class="predefined-constant">null</span>
        }
    }

    <span class="directive">protected</span> Optional&lt;ObjectId&gt; parseObjectId(<span class="predefined-type">String</span> input) {
        <span class="keyword">if</span> (ObjectId.isValid(input)) {
            Optional.of(<span class="keyword">new</span> ObjectId(input))
        }
        <span class="keyword">else</span> {
            Optional.empty()
        }
    }

}))</code></pre>
</div>
</div>
</div>
</div>


<h1 id="dataFetchers">6 Data Fetchers</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/dataFetchers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This library provides a means for overriding the data fetchers used for the default provided operations. That is done through the use of a <a href="../api/org/grails/gorm/graphql/fetcher/manager/GraphQLDataFetcherManager.html">GraphQLDataFetcherManager</a>.</p>
</div>
<div class="sect1">
<h2 id="_get_the_manager">Get The Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a fetcher, you need to get a reference to the <a href="../api/org/grails/gorm/graphql/fetcher/manager/GraphQLDataFetcherManager.html">GraphQLDataFetcherManager</a>. If you are using the manager provided by default, how you access it will depend on whether you are using the plugin or standalone.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>When creating the schema, initialize it first. The default fetcher manager will then be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.initialize()
GraphQLDataFetcherManager dataFetcherManager = schema.dataFetcherManager
...
schema.generate()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugin">Plugin</h3>
<div class="paragraph">
<p>For Grails applications it is recommended to reference the bean created by the plugin. The easiest way to do so is to register a bean post processor. The plugin has a class available to extend to make that easier.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myGraphQLCustomizer(MyGraphQLCustomizer)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLCustomizer.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.GraphQLPostProcessor</span>

<span class="type">class</span> <span class="class">MyGraphQLCustomizer</span> <span class="directive">extends</span> GraphQLPostProcessor {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWith(GraphQLDataFetcherManager dataFetcherManager) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to customize more than 1 manager, only a single bean needs to be registered. There are <code>doWith</code> methods for all of the managers you may need to register object instances with.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_fetcher">Register A Fetcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have access to the manager, registration of your own data fetcher is easy. In this example a data fetcher is being registered to handle soft deleting an entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Registering a fetcher for the <code>Object</code> type will allow it to be used for all domain classes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLDataFetcherManager dataFetcherManager

fetcherManager.registerDeletingDataFetcher(Author, <span class="keyword">new</span> DeleteEntityDataFetcher(Author.gormPersistentEntity) {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> deleteInstance(GormEntity instance) {
        Author author = ((Author)instance)
        author.active = <span class="predefined-constant">false</span>
        author.save()
    }
})</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A class exists to use for soft deletes: <a href="../api/org/grails/gorm/graphql/fetcher/impl/SoftDeleteEntityDataFetcher.html">SoftDeleteEntityDataFetcher</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are 3 types of data fetchers that can be registered.</p>
</div>
<div class="sect2">
<h3 id="_binding">Binding</h3>
<div class="paragraph">
<p>Binding data fetchers accept a data binder object to bind the argument(s) to the domain instance. When the binding data fetcher instances are retrieved from the manager, the data binder will be set automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deleting">Deleting</h3>
<div class="paragraph">
<p>Deleting data fetchers accept a delete response handler object that is responsible for determining how the fetcher should respond for delete requests. When the deleting data fetcher instances are retrieved from the manager, the delete response handler will be set automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reading">Reading</h3>
<div class="paragraph">
<p>Reading data fetchers are designed to execute read only queries. They don&#8217;t require any other dependencies to work.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_optimization">Query Optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of the default data fetcher classes extend from <a href="../api/org/grails/gorm/graphql/fetcher/DefaultGormDataFetcher.html">DefaultGormDataFetcher</a>. If you are creating your own custom data fetcher class, it is highly recommended to extend from it as well. The main reason for doing so is to take advantage of the built in query optimization. Based on what fields are requested in any given request, the default data fetchers will execute a query that will join any associations that have been requested. This feature ensures that each API call is as efficient as possible.</p>
</div>
<div class="paragraph">
<p>For example, consider the following domain structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}
<span class="type">class</span> <span class="class">Book</span> {
    <span class="directive">static</span> belongsTo = [<span class="key">author</span>: Author]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executing a query against a given book, if the author object is not requested, or if only the ID of the author is requested, the association will not be joined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book(<span class="key">id</span>: <span class="integer">5</span>) {
    author {
        id
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example generated SQL:</p>
</div>
<div class="paragraph">
<p><code>select * from book b where id = 5</code></p>
</div>
<div class="paragraph">
<p>When any property on the author other than the ID is requested, then the association will be joined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book(<span class="key">id</span>: <span class="integer">5</span>) {
    author {
        name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example generated SQL:</p>
</div>
<div class="paragraph">
<p><code>select * from book b inner join author a on b.author_id = a.id where b.id = 5</code></p>
</div>
<div class="paragraph">
<p>The logic for retrieving the list of properties to be joined is contained within the <a href="../api/org/grails/gorm/graphql/entity/EntityFetchOptions.html">EntityFetchOptions</a> class. If you prefer not to extend from the default gorm data fetcher, it is possible to make use of this class in your own data fetcher.</p>
</div>
<div class="sect2">
<h3 id="_custom_property_data_fetchers">Custom Property Data Fetchers</h3>
<div class="paragraph">
<p>When adding a custom property to a domain class, it may be the case that a separate query is being executed on another domain class. Normally that query would not be able to benefit from the automatic join operations based on the requested fields in that domain class. When providing the closure to retrieve the relevant data, a second parameter is available. The second parameter to the closure will be an instance of <a href="../api/org/grails/gorm/graphql/fetcher/impl/ClosureDataFetchingEnvironment.html">ClosureDataFetchingEnvironment</a>.</p>
</div>
<div class="paragraph">
<p>The environment is an extension of the GraphQL Java <code>DataFetchingEnvironment</code>. In addition to everything the standard environment has, the environment also has methods for retrieving the fetch options or the list of join properties to use in your query.</p>
</div>
<div class="paragraph">
<p>In this example a property was added to the <code>Tag</code> domain to retrieve the list of <code>Post</code> objects that contain the given tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Set</span>&lt;Post&gt; getPosts(<span class="predefined-type">Map</span> queryArgs) {
    <span class="predefined-type">Long</span> tagId = <span class="local-variable">this</span>.id
    Post.where { tags { id == tagId } }.list(queryArgs)
}

<span class="directive">static</span> graphql = GraphQLMapping.build {
    add(<span class="string"><span class="delimiter">'</span><span class="content">posts</span><span class="delimiter">'</span></span>, [Post]) {
        input <span class="predefined-constant">false</span>
        dataFetcher { Tag tag, ClosureDataFetchingEnvironment env -&gt;
            tag.getPosts(env.fetchArguments)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>


<h1 id="dataBinders">7 Data Binding</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/dataBinders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Data binders are responsible for taking the domain argument to a create or update operation and binding the data to an instance of the entity being created or updated.</p>
</div>
<div class="sect1">
<h2 id="_get_the_manager">Get The Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a data binders, you need to get a reference to the <a href="../api/org/grails/gorm/graphql/binding/GraphQLDataBinderManager.html">GraphQLDataBinderManager</a>. If you are using the manager provided by default, how you access it will depend on whether you are using the plugin or standalone.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>When creating the schema, initialize it first. The default binder manager will then be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.initialize()
GraphQLDataBinderManager dataBinderManager = schema.dataBinderManager
...
schema.generate()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugin">Plugin</h3>
<div class="paragraph">
<p>For Grails applications it is recommended to reference the bean created by the plugin. The easiest way to do so is to register a bean post processor. The plugin has a class available to extend to make that easier.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myGraphQLCustomizer(MyGraphQLCustomizer)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLCustomizer.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.GraphQLPostProcessor</span>

<span class="type">class</span> <span class="class">MyGraphQLCustomizer</span> <span class="directive">extends</span> GraphQLPostProcessor {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWith(GraphQLDataBinderManager dataBinderManager) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to customize more than 1 manager, only a single bean needs to be registered. There are <code>doWith</code> methods for all of the managers you may need to register object instances with.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_data_binder">Register A Data Binder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have access to the manager, registration of your own data binder is easy. In this example a data binder is being registered for the Author domain class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLDataBinderManager dataBinderManager

dataBinderManager.registerDataBinder(Author, <span class="keyword">new</span> GraphQLDataBinder() {

    <span class="annotation">@Override</span>
    <span class="type">void</span> bind(<span class="predefined-type">Object</span> object, <span class="predefined-type">Map</span> data) {
        Author author = (Author) object
        author.name = data.name
    }
})</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Registering a data binder for the <code>Object</code> type will cause it to be executed when a data binder could not otherwise be found.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Grails applications, a default data binder is supplied that uses the standard Grails data binding features. That will allow you to customize the binding via <code>@BindUsing</code> or any other mechanism available via that feature.
</td>
</tr>
</table>
</div>
</div>
</div>


<h1 id="interceptors">8 Interceptors</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/interceptors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This library provides 2 types of interceptors, data fetcher and schema. Data fetcher interceptors are designed with the ability to prevent execution of a data fetcher. A common application of a data fetcher interceptor might be to implement security for the different operations available to be executed through GraphQL.</p>
</div>
<div class="paragraph">
<p>Schema interceptors allow users to hook directly into the schema creation process to modify the schema directly before it is created. This option is for users who are comfortable with the <a href="https://github.com/graphql-java/graphql-java">graphql-java</a> library and would like to manipulate the schema as they see fit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any interceptor can implement <a href="http://gorm.grails.org/latest/api//org/grails/datastore/mapping/core/Ordered.html">Ordered</a> to control the order it is invoked.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_get_the_manager">Get The Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a data fetcher interceptor, you need to get a reference to the <a href="../api/org/grails/gorm/graphql/interceptor/manager/GraphQLInterceptorManager.html">GraphQLInterceptorManager</a>. If you are using the manager provided by default, how you access it will depend on whether you are using the plugin or standalone.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>When creating the schema, initialize it first. The default interceptor manager will then be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.initialize()
GraphQLInterceptorManager interceptorManager = schema.interceptorManager
...
schema.generate()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugin">Plugin</h3>
<div class="paragraph">
<p>For Grails applications it is recommended to reference the bean created by the plugin. The easiest way to do so is to register a bean post processor. The plugin has a class available to extend to make that easier.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myGraphQLCustomizer(MyGraphQLCustomizer)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLCustomizer.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.GraphQLPostProcessor</span>

<span class="type">class</span> <span class="class">MyGraphQLCustomizer</span> <span class="directive">extends</span> GraphQLPostProcessor {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWith(GraphQLInterceptorManager interceptorManager) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to customize more than 1 manager, only a single bean needs to be registered. There are <code>doWith</code> methods for all of the managers you may need to register object instances with.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_fetcher_interceptors">Data Fetcher Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All data fetcher interceptors must implement the <a href="../api/org/grails/gorm/graphql/interceptor/GraphQLFetcherInterceptor.html">GraphQLFetcherInterceptor</a> interface. A <a href="../api/org/grails/gorm/graphql/interceptor/impl/BaseGraphQLFetcherInterceptor">base class</a> is also available to extend from that allows all fetchers to proceed.</p>
</div>
<div class="paragraph">
<p>For all interceptor methods, if the return value is <code>false</code>, further interceptors will not be executed and the resulting data will be <code>null</code>.</p>
</div>
<div class="sect2">
<h3 id="_registering">Registering</h3>
<div class="paragraph">
<p>Once you have access to the manager, registration of your own interceptor is easy. In this example a data fetcher interceptor is being executed for the Author domain class. The interceptor will get invoked for all operations executed for that domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLInterceptorManager interceptorManager

interceptorManager.registerInterceptor(Author, <span class="keyword">new</span> AuthorFetcherInterceptor())</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Registering an interceptor for the <code>Object</code> type will cause it to be executed for all domain classes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_provided">Provided</h3>
<div class="paragraph">
<p>There are two methods that will be invoked for provided data fetchers. Which one gets invoked depends on whether the operation is a query or a mutation. For query operations (GET, LIST), the <code>onQuery</code> method will be executed. For mutation operations (CREATE, UPDATE, DELETE), the <code>onMutation</code> method will be executed.</p>
</div>
<div class="paragraph">
<p>The data fetching environment and the data fetcher type are available to help make decisions about whether or not to interrupt the execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom">Custom</h3>
<div class="paragraph">
<p>There are two methods that will be invoked for custom data fetchers. For operations registered with the <code>query</code> method in the mapping, the <code>onCustomQuery</code> method will be invoked. For operations registered with the <code>mutation</code> method in the mapping, the <code>onCustomMutation</code> method will be invoked.</p>
</div>
<div class="paragraph">
<p>For custom operations, the name of the operation is available to be able to distinguish one custom operation from another.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_schema_interceptors">Schema Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to data fetcher interceptors, it is also possible to register an interceptor for the GraphQL schema before it is built. These interceptors have the ability to intercept each persistent entity after its types are created, but before building, as well as one final interception before the schema as a whole is built.</p>
</div>
<div class="sect2">
<h3 id="_registration">Registration</h3>
<div class="paragraph">
<p>Once you have access to the manager, registration of your own interceptor is easy. In this example a schema interceptor is being registered. The interceptor will get invoked for all entities as they are being created as well as once before the schema is finalized.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLInterceptorManager interceptorManager

interceptorManager.registerInterceptor(<span class="keyword">new</span> MySchemaInterceptor())</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entity">Entity</h3>
<div class="paragraph">
<p>As each entity is being processed, a list of query fields and a list of mutation fields are being built. Before those fields are passed to the root query or mutation object, any schema interceptors are invoked with the intention that they may mutate the lists of fields. The persistent entity is also available to the interceptor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_schema">Final Schema</h3>
<div class="paragraph">
<p>After all of the entities have been processed, schema interceptors are invoked with the query type and mutation type. Once again, this provides the opportunity to make changes before the types are built and passed to the root schema object.</p>
</div>
</div>
</div>
</div>


<h1 id="otherNotes">9 Other Notes</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/otherNotes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_other_notes">Other Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section of the documentation is designed to inform you about special circumstances that may impact some use cases.</p>
</div>
<div class="sect2">
<h3 id="_metadata">Metadata</h3>
<div class="paragraph">
<p>You may come across a time when you would like to supply metadata for a property or type, but because that type is not part of an exposed persistent entity, it is not possible to do so via the mapping DSL. For those use cases, a <a href="../api/org/grails/gorm/graphql/GraphQL.html">@GraphQL</a> annotation exists. The annotation can be applied to related entities or enums, for example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nullability">Nullability</h3>
<div class="paragraph">
<p>The nullable constraint on persistent properties is only respected during the create operation. For all other cases, null is always allowed. The reasoning for allowing nulls for output operations (get or list) is due to the possibility of the properties being null as a result of validation errors during a create or update. Nulls are allowed for update operations to allow users to send a partial object instead of the entire object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inheritance">Inheritance</h3>
<div class="paragraph">
<p>Because GraphQL doesn&#8217;t support the ability to have interfaces extend other interfaces, interface types will only be created for root entities that have children. All child entities, regardless of any intermediate parent classes, will set their interface type to their root entity interface.</p>
</div>
<div class="paragraph">
<p>When querying the root entity, all children will be available to select properties via the <code>&#8230;&#8203; on</code> directive.</p>
</div>
</div>
<div class="sect2">
<h3 id="_map_properties">Map Properties</h3>
<div class="paragraph">
<p>Since `Map`s by definition are dynamic, they don&#8217;t fit well into the pre defined world that is the GraphQL schema. It is impossible to render them as they are with dynamic keys because the schema must be statically defined. There are a couple ways to work around this depending on how you are using the properties.</p>
</div>
<div class="sect3">
<h4 id="_truly_dynamic">Truly Dynamic</h4>
<div class="paragraph">
<p>For <code>Map</code> properties where the keys are not known at all, it is entirely up to the user to determine how it should be handled. One example might be to return a list of objects instead. For example, consider the following domain class:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Author.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="comment">//The key is the ISBN</span>
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Book</span>&gt; books

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is impossible to know what keys will be used in this example, so we will need to provide the data in a predefined format. Instead of a <code>Map&lt;String, Book&gt;</code>, we could return the books as a <code>List&lt;Map&gt;</code> where each map has a <code>key</code> property and a <code>value</code> property.</p>
</div>
<div class="paragraph">
<p>To accomplish this there are several steps necessary to take in order for everything to work property.</p>
</div>
<div class="sect4">
<h5 id="_configure_the_property">Configure The Property</h5>
<div class="paragraph">
<p>The property must be modified to contain the definition proposed above. In order to change the data type of a property, it must first be excluded and then replaced with a custom property.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Author.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="comment">//The key is the ISBN</span>
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Book</span>&gt; books

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="directive">static</span> graphql = GraphQLMapping.build {

        exclude <span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

        add(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">BookMap</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
            type { <i class="conum" data-value="3"></i><b>(3)</b>
                field(<span class="string"><span class="delimiter">'</span><span class="content">key</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
                field(<span class="string"><span class="delimiter">'</span><span class="content">value</span><span class="delimiter">'</span></span>, <span class="predefined-type">Book</span>)
                collection <span class="predefined-constant">true</span>
            }
            dataFetcher { Author author -&gt;
                <span class="comment">//author.books.entrySet() does not work here because</span>
                <span class="comment">//the graphql-java implementation calls .get() on maps</span>
                author.books.collect { key, value -&gt; <i class="conum" data-value="4"></i><b>(4)</b>
                    [<span class="key">key</span>: key, <span class="key">value</span>: value]
                }.sort(<span class="predefined-constant">true</span>, {a, b -&gt; a.value.id &lt;=&gt; b.value.id})
            }
        }

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The persistent property is excluded from the schema</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A custom property is created in its place</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom type is defined for our property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The data is converted to the expected data type that GraphQL expects</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The domain class configuration is enough to be able to retrieve author instances with GraphQL. If users are to be creating or updating instances, there is more work to do.</p>
</div>
</div>
<div class="sect4">
<h5 id="_data_binding">Data Binding</h5>
<div class="paragraph">
<p>A data binder must be configured to transform the data sent in the <code>key/value</code> object format to a format that can be bound to the domain. For those using this library standalone, it is up to you to determine how that is best done. Grails data binding supports binding to Map types, given the request data is in a specific format. To achieve that format, a data binder for the <code>Author</code> domain must be registered.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/AuthorDataBinder.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.binding.GrailsGraphQLDataBinder</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">AuthorDataBinder</span> <span class="directive">extends</span> GrailsGraphQLDataBinder {

    <span class="annotation">@Override</span>
    <span class="type">void</span> bind(<span class="predefined-type">Object</span> object, <span class="predefined-type">Map</span> data) {
        <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&gt; books = (<span class="predefined-type">List</span>)data.remove(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>)
        <span class="keyword">for</span> (<span class="predefined-type">Map</span> <span class="key">entry</span>: books) {
            data.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">books[</span><span class="inline"><span class="inline-delimiter">${</span>entry.key<span class="inline-delimiter">}</span></span><span class="content">]</span><span class="delimiter">&quot;</span></span>.toString(), entry.value)
        }
        <span class="local-variable">super</span>.bind(object, data)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then to register the data binder, see the section on <a href="#dataBinders.html">data binders</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pre_defined_keys">Pre Defined Keys</h4>
<div class="paragraph">
<p>For <code>Map</code> properties where the keys of the map are known, the process to handle them is much easier. In this example, there is a Map property on our <code>Author</code> domain class that can store a <code>lat</code> key and a <code>long</code> key to represent latitude and longitude.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Author.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">Map</span> homeLocation

    <span class="directive">static</span> graphql = GraphQLMapping.build {

        exclude <span class="string"><span class="delimiter">'</span><span class="content">homeLocation</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

        add(<span class="string"><span class="delimiter">'</span><span class="content">homeLocation</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Location</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
            type { <i class="conum" data-value="3"></i><b>(3)</b>
                field(<span class="string"><span class="delimiter">'</span><span class="content">lat</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
                field(<span class="string"><span class="delimiter">'</span><span class="content">long</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
            }
        }

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The persistent property is excluded from the schema</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A custom property is created in its place</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom type is defined for our property</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_all_together">All Together</h4>
<div class="paragraph">
<p>Once all of the above is in place, here is what a create mutation might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X "POST" "http://localhost:8080/graphql" \
     -H "Content-Type: application/graphql" \
     -d $'
mutation {
  authorCreate(author: {
    name: "Sally",
    homeLocation: {
      lat: "41.101539",
      long: "-80.653381"
    },
    books: [
      {key: "0307887448", value: {title: "Ready Player One"}},
      {key: "0743264746", value: {title: "Einstein: His Life and Universe"}}
    ]
  }) {
    id
    name
    homeLocation {
      lat
      long
    }
    books {
      key
      value {
        id
        title
      }
    }
    errors {
      field
      message
    }
  }
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the expected response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">authorCreate</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Sally</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">homeLocation</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">lat</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">41.101539</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">long</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">-80.653381</span><span class="delimiter">&quot;</span></span>
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>: [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0743264746</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Einstein: His Life and Universe</span><span class="delimiter">&quot;</span></span>
                    }
                },
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0307887448</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Ready Player One</span><span class="delimiter">&quot;</span></span>
                    }
                }
            ],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>: [

            ]
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>


<h1 id="APIDocs">10 API Docs</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/master/docs/src/main/docs/guide/APIDocs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Click <a href="../api">here</a> to view the API Documentation.</p>
</div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
