<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Type Conversion And Creation 2.0.2-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        GORM GraphQL
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/installation.html"><strong>2</strong><span>Installation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>3</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/customizations.html"><strong>4</strong><span>Customizing The Schema</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/types.html"><strong>5</strong><span>Type Conversion And Creation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataFetchers.html"><strong>6</strong><span>Data Fetchers</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataBinders.html"><strong>7</strong><span>Data Binding</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/interceptors.html"><strong>8</strong><span>Interceptors</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/otherNotes.html"><strong>9</strong><span>Other Notes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/APIDocs.html"><strong>10</strong><span>API Docs</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/customizations.html">&lt;&lt; <strong>4</strong><span>Customizing The Schema</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/dataFetchers.html"><strong>6</strong><span>Data Fetchers</span> >></a></div>
                


                <div class="project">
                    <h1>5 Type Conversion And Creation</h1>

                    <p><strong>Version:</strong> 2.0.2-SNAPSHOT</p>
                </div>

                

                

<h1 id="types">5 Type Conversion And Creation</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/gorm-graphql/edit/2.0.x/src/main/docs/guide/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is the responsibility of the type manager to convert Java classes to GraphQL types used in the creation of the schema. All of the basic GORM types have corresponding converters registered in the default type manager. It may be necessary to register GraphQL types for classes used in your domain model.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The type manager is designed to store GraphQL types for non GORM entities (simple types). If you encounter a <a href="../api/org/grails/gorm/graphql/types/TypeNotFoundException.html">TypeNotFoundException</a>, it is likely you will need to register a type for the missing class.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_get_the_manager">Get The Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register type converters, you need to get a reference to the <a href="../api/org/grails/gorm/graphql/types/GraphQLTypeManager.html">GraphQLTypeManager</a>. If you are using the manager provided by default, how you access it will depend on whether you are using the plugin or standalone.</p>
</div>
<div class="sect2">
<h3 id="_standalone">Standalone</h3>
<div class="paragraph">
<p>When creating the schema, initialize it first. The default type manager will then be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.Schema</span>

<span class="predefined-type">Schema</span> schema = ...
schema.initialize()
GraphQLTypeManager typeManager = schema.typeManager
...
schema.generate()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugin">Plugin</h3>
<div class="paragraph">
<p>For Grails applications it is recommended to reference the bean created by the plugin. The easiest way to do so is to register a bean post processor. The plugin has a class available to extend to make that easier.</p>
</div>
<div class="listingblock">
<div class="title">resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myGraphQLCustomizer(MyGraphQLCustomizer)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/MyGraphQLCustomizer.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.gorm.graphql.plugin.GraphQLPostProcessor</span>

<span class="type">class</span> <span class="class">MyGraphQLCustomizer</span> <span class="directive">extends</span> GraphQLPostProcessor {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWith(GraphQLTypeManager typeManager) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need to customize more than 1 manager, only a single bean needs to be registered. There are <code>doWith</code> methods for all of the managers you may need to register object instances with.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_register_a_converter">Register A Converter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have access to the manager, registration of your own type is easy. In this example a type is being registered to handle a Mongo <code>ObjectId</code>. The type will be used to do conversion of arguments in GraphQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This process only handles how an ObjectId will be created from either Java arguments, or arguments passed inline in the GraphQL query or mutation. For Grails applications, the process of rendering the ObjectID as json is handled by <a href="http://views.grails.org">JSON views</a>. To supply behavior for how an ObjectId is rendered, see the documentation for json views. For standalone projects, you are responsible for any conversions that may need to happen.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">graphql.schema.GraphQLScalarType</span>
<span class="keyword">import</span> <span class="include">org.bson.types.ObjectId</span>
<span class="keyword">import</span> <span class="include">graphql.schema.Coercing</span>

GraphQLTypeManager typeManager

typeManager.registerType(ObjectId, <span class="keyword">new</span> GraphQLScalarType(<span class="string"><span class="delimiter">&quot;</span><span class="content">ObjectId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hex representation of a Mongo object id</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Coercing&lt;ObjectId, ObjectId&gt;() {

    <span class="directive">protected</span> Optional&lt;ObjectId&gt; convert(<span class="predefined-type">Object</span> input) {
        <span class="keyword">if</span> (input <span class="keyword">instanceof</span> ObjectId) {
            Optional.of((ObjectId) input)
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (input <span class="keyword">instanceof</span> <span class="predefined-type">String</span>) {
            parseObjectId((<span class="predefined-type">String</span>) input)
        }
        <span class="keyword">else</span> {
            Optional.empty()
        }
    }

    <span class="annotation">@Override</span>
    ObjectId serialize(<span class="predefined-type">Object</span> input) {
        convert(input).orElseThrow( {
            <span class="keyword">throw</span> <span class="keyword">new</span> CoercingSerializeException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not convert </span><span class="inline"><span class="inline-delimiter">${</span>input.class.name<span class="inline-delimiter">}</span></span><span class="content"> to an ObjectId</span><span class="delimiter">&quot;</span></span>)
        })
    }

    <span class="annotation">@Override</span>
    ObjectId parseValue(<span class="predefined-type">Object</span> input) {
        convert(input).orElseThrow( {
            <span class="keyword">throw</span> <span class="keyword">new</span> CoercingParseValueException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not convert </span><span class="inline"><span class="inline-delimiter">${</span>input.class.name<span class="inline-delimiter">}</span></span><span class="content"> to an ObjectId</span><span class="delimiter">&quot;</span></span>)
        })
    }

    <span class="annotation">@Override</span>
    ObjectId parseLiteral(<span class="predefined-type">Object</span> input) {
        <span class="keyword">if</span> (input <span class="keyword">instanceof</span> StringValue) {
            parseObjectId(((StringValue) input).value).orElse(<span class="predefined-constant">null</span>)
        }
        <span class="keyword">else</span> {
            <span class="predefined-constant">null</span>
        }
    }

    <span class="directive">protected</span> Optional&lt;ObjectId&gt; parseObjectId(<span class="predefined-type">String</span> input) {
        <span class="keyword">if</span> (ObjectId.isValid(input)) {
            Optional.of(<span class="keyword">new</span> ObjectId(input))
        }
        <span class="keyword">else</span> {
            Optional.empty()
        }
    }

}))</code></pre>
</div>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/customizations.html">&lt;&lt; <strong>4</strong><span>Customizing The Schema</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/dataFetchers.html"><strong>6</strong><span>Data Fetchers</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
